{"ast":null,"code":"\"use strict\";\n\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar channel_1 = require(\"../channel\");\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\nvar BOLT_MAGIC_PREAMBLE = 0x6060b017;\nfunction version(major, minor) {\n  return {\n    major: major,\n    minor: minor\n  };\n}\nfunction createHandshakeMessage(versions) {\n  if (versions.length > 4) {\n    throw (0, neo4j_driver_core_1.newError)('It should not have more than 4 versions of the protocol');\n  }\n  var handshakeBuffer = (0, channel_1.alloc)(5 * 4);\n  handshakeBuffer.writeInt32(BOLT_MAGIC_PREAMBLE);\n  versions.forEach(function (version) {\n    if (version instanceof Array) {\n      var _a = version[0],\n        major = _a.major,\n        minor = _a.minor;\n      var minMinor = version[1].minor;\n      var range = minor - minMinor;\n      handshakeBuffer.writeInt32(range << 16 | minor << 8 | major);\n    } else {\n      var major = version.major,\n        minor = version.minor;\n      handshakeBuffer.writeInt32(minor << 8 | major);\n    }\n  });\n  handshakeBuffer.reset();\n  return handshakeBuffer;\n}\nfunction parseNegotiatedResponse(buffer, log) {\n  var h = [buffer.readUInt8(), buffer.readUInt8(), buffer.readUInt8(), buffer.readUInt8()];\n  if (h[0] === 0x48 && h[1] === 0x54 && h[2] === 0x54 && h[3] === 0x50) {\n    log.error('Handshake failed since server responded with HTTP.');\n    throw (0, neo4j_driver_core_1.newError)('Server responded HTTP. Make sure you are not trying to connect to the http endpoint ' + '(HTTP defaults to port 7474 whereas BOLT defaults to port 7687)');\n  }\n  return Number(h[3] + '.' + h[2]);\n}\n/**\n * @return {BaseBuffer}\n * @private\n */\nfunction newHandshakeBuffer() {\n  return createHandshakeMessage([[version(5, 6), version(5, 0)], [version(4, 4), version(4, 2)], version(4, 1), version(3, 0)]);\n}\n/**\n * This callback is displayed as a global member.\n * @callback BufferConsumerCallback\n * @param {buffer} buffer the remaining buffer\n */\n/**\n * @typedef HandshakeResult\n * @property {number} protocolVersion The protocol version negotiated in the handshake\n * @property {function(BufferConsumerCallback)} consumeRemainingBuffer A function to consume the remaining buffer if it exists\n */\n/**\n * Shake hands using the channel and return the protocol version\n *\n * @param {Channel} channel the channel use to shake hands\n * @param {Logger} log the log object\n * @returns {Promise<HandshakeResult>} Promise of protocol version and consumeRemainingBuffer\n */\nfunction handshake(channel, log) {\n  var _this = this;\n  return new Promise(function (resolve, reject) {\n    var handshakeErrorHandler = function (error) {\n      reject(error);\n    };\n    channel.onerror = handshakeErrorHandler.bind(_this);\n    if (channel._error) {\n      handshakeErrorHandler(channel._error);\n    }\n    channel.onmessage = function (buffer) {\n      try {\n        // read the response buffer and initialize the protocol\n        var protocolVersion = parseNegotiatedResponse(buffer, log);\n        resolve({\n          protocolVersion: protocolVersion,\n          consumeRemainingBuffer: function (consumer) {\n            if (buffer.hasRemaining()) {\n              consumer(buffer.readSlice(buffer.remaining()));\n            }\n          }\n        });\n      } catch (e) {\n        reject(e);\n      }\n    };\n    channel.write(newHandshakeBuffer());\n  });\n}\nexports.default = handshake;","map":{"version":3,"names":["Object","defineProperty","exports","value","channel_1","require","neo4j_driver_core_1","BOLT_MAGIC_PREAMBLE","version","major","minor","createHandshakeMessage","versions","length","newError","handshakeBuffer","alloc","writeInt32","forEach","Array","_a","minMinor","range","reset","parseNegotiatedResponse","buffer","log","h","readUInt8","error","Number","newHandshakeBuffer","handshake","channel","_this","Promise","resolve","reject","handshakeErrorHandler","onerror","bind","_error","onmessage","protocolVersion","consumeRemainingBuffer","consumer","hasRemaining","readSlice","remaining","e","write","default"],"sources":["C:/Users/gelgo/Documents/IUT/BUT3/R5.10 - Nouveaux paradigmes de BDD/cluedo-game/node_modules/neo4j-driver-bolt-connection/lib/bolt/handshake.js"],"sourcesContent":["\"use strict\";\n/**\n * Copyright (c) \"Neo4j\"\n * Neo4j Sweden AB [https://neo4j.com]\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar channel_1 = require(\"../channel\");\nvar neo4j_driver_core_1 = require(\"neo4j-driver-core\");\nvar BOLT_MAGIC_PREAMBLE = 0x6060b017;\nfunction version(major, minor) {\n    return {\n        major: major,\n        minor: minor\n    };\n}\nfunction createHandshakeMessage(versions) {\n    if (versions.length > 4) {\n        throw (0, neo4j_driver_core_1.newError)('It should not have more than 4 versions of the protocol');\n    }\n    var handshakeBuffer = (0, channel_1.alloc)(5 * 4);\n    handshakeBuffer.writeInt32(BOLT_MAGIC_PREAMBLE);\n    versions.forEach(function (version) {\n        if (version instanceof Array) {\n            var _a = version[0], major = _a.major, minor = _a.minor;\n            var minMinor = version[1].minor;\n            var range = minor - minMinor;\n            handshakeBuffer.writeInt32((range << 16) | (minor << 8) | major);\n        }\n        else {\n            var major = version.major, minor = version.minor;\n            handshakeBuffer.writeInt32((minor << 8) | major);\n        }\n    });\n    handshakeBuffer.reset();\n    return handshakeBuffer;\n}\nfunction parseNegotiatedResponse(buffer, log) {\n    var h = [\n        buffer.readUInt8(),\n        buffer.readUInt8(),\n        buffer.readUInt8(),\n        buffer.readUInt8()\n    ];\n    if (h[0] === 0x48 && h[1] === 0x54 && h[2] === 0x54 && h[3] === 0x50) {\n        log.error('Handshake failed since server responded with HTTP.');\n        throw (0, neo4j_driver_core_1.newError)('Server responded HTTP. Make sure you are not trying to connect to the http endpoint ' +\n            '(HTTP defaults to port 7474 whereas BOLT defaults to port 7687)');\n    }\n    return Number(h[3] + '.' + h[2]);\n}\n/**\n * @return {BaseBuffer}\n * @private\n */\nfunction newHandshakeBuffer() {\n    return createHandshakeMessage([\n        [version(5, 6), version(5, 0)],\n        [version(4, 4), version(4, 2)],\n        version(4, 1),\n        version(3, 0)\n    ]);\n}\n/**\n * This callback is displayed as a global member.\n * @callback BufferConsumerCallback\n * @param {buffer} buffer the remaining buffer\n */\n/**\n * @typedef HandshakeResult\n * @property {number} protocolVersion The protocol version negotiated in the handshake\n * @property {function(BufferConsumerCallback)} consumeRemainingBuffer A function to consume the remaining buffer if it exists\n */\n/**\n * Shake hands using the channel and return the protocol version\n *\n * @param {Channel} channel the channel use to shake hands\n * @param {Logger} log the log object\n * @returns {Promise<HandshakeResult>} Promise of protocol version and consumeRemainingBuffer\n */\nfunction handshake(channel, log) {\n    var _this = this;\n    return new Promise(function (resolve, reject) {\n        var handshakeErrorHandler = function (error) {\n            reject(error);\n        };\n        channel.onerror = handshakeErrorHandler.bind(_this);\n        if (channel._error) {\n            handshakeErrorHandler(channel._error);\n        }\n        channel.onmessage = function (buffer) {\n            try {\n                // read the response buffer and initialize the protocol\n                var protocolVersion = parseNegotiatedResponse(buffer, log);\n                resolve({\n                    protocolVersion: protocolVersion,\n                    consumeRemainingBuffer: function (consumer) {\n                        if (buffer.hasRemaining()) {\n                            consumer(buffer.readSlice(buffer.remaining()));\n                        }\n                    }\n                });\n            }\n            catch (e) {\n                reject(e);\n            }\n        };\n        channel.write(newHandshakeBuffer());\n    });\n}\nexports.default = handshake;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}